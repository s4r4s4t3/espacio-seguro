{% extends 'base.html' %}
{% block title %}{{ _('Inicio - SafeSpace') }}{% endblock %}
{% block content %}

    <div class="card home-card">
      <div class="center-content">
        <img src="{{ url_for('static', filename='heart.png') }}" alt="{{ _('Mascota SafeSpace') }}" class="landing-logo" />

        <!-- ğŸŒ Selector de idioma -->
        <form id="language-form" method="GET" class="language-form">
          <select name="lang" id="language-select">
            <option value="es" {% if g.get('lang') == 'es' %}selected{% endif %}>ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
            <option value="en" {% if g.get('lang') == 'en' %}selected{% endif %}>ğŸ‡ºğŸ‡¸ English</option>
            <option value="pt" {% if g.get('lang') == 'pt' %}selected{% endif %}>ğŸ‡µğŸ‡¹ PortuguÃªs</option>
            <option value="br" {% if g.get('lang') == 'br' %}selected{% endif %}>ğŸ‡§ğŸ‡· PortuguÃªs (BR)</option>
            <option value="de" {% if g.get('lang') == 'de' %}selected{% endif %}>ğŸ‡©ğŸ‡ª Deutsch</option>
            <option value="fr" {% if g.get('lang') == 'fr' %}selected{% endif %}>ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="it" {% if g.get('lang') == 'it' %}selected{% endif %}>ğŸ‡®ğŸ‡¹ Italiano</option>
          </select>
        </form>

        <!-- ğŸ‘¤ Bienvenida -->
        <h2>{{ _('Bienvenido, %(username)s', username=user.username) }}</h2>

        <!-- ğŸ“² BotÃ³n de instalaciÃ³n PWA -->
        <button id="install-btn" class="btn full-width" style="display:none;">
          {{ _('ğŸ“² Instalar SafeSpace') }}
        </button>

        <!-- ğŸ§­ NavegaciÃ³n principal -->
        <div class="home-nav">
          <a href="/config" class="btn">{{ _('Perfil') }}</a>
          <a href="/chat" class="btn">{{ _('Chat Global') }}</a>
          <a href="/amigos" class="btn">{{ _('Amigos') }}</a>
          <a href="/panico" class="btn btn-reject">{{ _('BotÃ³n de PÃ¡nico') }}</a>
          <a href="{{ url_for('diary.diary') }}" class="btn">{{ _('Diario') }}</a>
          <a href="{{ url_for('home.feed') }}" class="btn">{{ _('Feed') }}</a>
          <a href="{{ url_for('home.nueva_publicacion') }}" class="btn btn-add">{{ _('Nueva publicaciÃ³n') }}</a>
          <a href="/logout" class="btn">{{ _('Cerrar sesiÃ³n') }}</a>
        </div>
      </div>
    </div>
  </div>

  <!-- ğŸ”§ Service Worker + PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register("{{ url_for('static', filename='service-worker.js') }}")
        .then(function(reg) {
          console.log("âœ… Service Worker registrado con Ã©xito:", reg.scope);
        })
        .catch(function(error) {
          console.error("âŒ Error al registrar el Service Worker:", error);
        });
    }

    let deferredPrompt;
    const installBtn = document.getElementById('install-btn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';

      installBtn.addEventListener('click', async () => {
        installBtn.style.display = 'none';
        deferredPrompt.prompt();
        const choiceResult = await deferredPrompt.userChoice;
        console.log("âœ… InstalaciÃ³n:", choiceResult.outcome);
        deferredPrompt = null;
      });
    });
  </script>
{% endblock %}
