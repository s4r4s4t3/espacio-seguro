{% extends 'base.html' %}
{% block title %}{{ _('Inicio - SafeSpace') }}{% endblock %}
{% block content %}

<<<<<<< HEAD
    <div class="card home-card">
      <h2>{{ _('Bienvenido, %(username)s', username=user.username) }}</h2>
      <p>{{ _('Gracias por unirte a SafeSpace. Navega utilizando el menÃº de la izquierda.') }}</p>
    
=======
  <div class="card home-card">
    <div class="center-content">
      <img src="{{ url_for('static', filename='heart.png') }}" alt="{{ _('Mascota SafeSpace') }}" class="landing-logo" />

      <!-- ğŸŒ Selector de idioma -->
      <form id="language-form" method="GET" class="language-form">
        <select name="lang" id="language-select" aria-label="{{ _('Seleccionar idioma') }}">
          <option value="es"    {% if g.get('lang') in ['es','es_ES'] %}selected{% endif %}>ğŸ‡ªğŸ‡¸ {{ _('EspaÃ±ol') }}</option>
          <option value="en"    {% if g.get('lang') in ['en','en_US','en_GB'] %}selected{% endif %}>ğŸ‡ºğŸ‡¸ {{ _('English') }}</option>
          <option value="pt_PT" {% if g.get('lang') in ['pt','pt_PT'] %}selected{% endif %}>ğŸ‡µğŸ‡¹ {{ _('PortuguÃªs (PT)') }}</option>
          <option value="pt_BR" {% if g.get('lang') in ['br','pt_BR'] %}selected{% endif %}>ğŸ‡§ğŸ‡· {{ _('PortuguÃªs (BR)') }}</option>
          <option value="de"    {% if g.get('lang') == 'de' %}selected{% endif %}>ğŸ‡©ğŸ‡ª {{ _('Deutsch') }}</option>
          <option value="fr"    {% if g.get('lang') == 'fr' %}selected{% endif %}>ğŸ‡«ğŸ‡· {{ _('FranÃ§ais') }}</option>
          <option value="it"    {% if g.get('lang') == 'it' %}selected{% endif %}>ğŸ‡®ğŸ‡¹ {{ _('Italiano') }}</option>
        </select>
      </form>

      <!-- ğŸ‘¤ Bienvenida -->
      <h2>{{ _('Bienvenido, %(username)s', username=user.username) }}</h2>

      <!-- ğŸ“² BotÃ³n de instalaciÃ³n PWA -->
      <button id="install-btn" class="btn full-width" style="display:none;">
        {{ _('ğŸ“² Instalar SafeSpace') }}
      </button>

      <!-- ğŸ§­ NavegaciÃ³n principal -->
      <div class="home-nav">
        <a href="{{ url_for('config.config') }}" class="btn">{{ _('Perfil') }}</a>
        <a href="{{ url_for('home.chat') }}" class="btn">{{ _('Chat Global') }}</a>
        <a href="{{ url_for('amigos.amigos') }}" class="btn">{{ _('Amigos') }}</a>
        <a href="{{ url_for('home.panico') }}" class="btn btn-reject">{{ _('BotÃ³n de PÃ¡nico') }}</a>
        <a href="{{ url_for('diary.diary') }}" class="btn">{{ _('Diario') }}</a>
        <a href="{{ url_for('home.feed') }}" class="btn">{{ _('Feed') }}</a>
        <a href="{{ url_for('home.nueva_publicacion') }}" class="btn btn-add">{{ _('Nueva publicaciÃ³n') }}</a>
        <a href="{{ url_for('auth.logout') }}" class="btn">{{ _('Cerrar sesiÃ³n') }}</a>
      </div>
    </div>
>>>>>>> 6530948 (feat: i18n + PWA offline; SW v1.0.1, manifest EN y base dinÃ¡mica; JS chat/toggles/previews/dark-mode)
  </div>

  <!-- ğŸ”§ Service Worker + PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register("{{ url_for('static', filename='service-worker.js') }}")
        .then(function(reg) {
          console.log("âœ… Service Worker registrado con Ã©xito:", reg.scope);
        })
        .catch(function(error) {
          console.error("âŒ Error al registrar el Service Worker:", error);
        });
    }

    let deferredPrompt;
    const installBtn = document.getElementById('install-btn');

    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';

      installBtn.addEventListener('click', async () => {
        installBtn.style.display = 'none';
        deferredPrompt.prompt();
        const choiceResult = await deferredPrompt.userChoice;
        console.log("âœ… InstalaciÃ³n:", choiceResult.outcome);
        deferredPrompt = null;
      });
    });
  </script>
{% endblock %}
