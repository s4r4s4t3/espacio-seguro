{% extends 'base.html' %}
{% block title %}{{ _('üì∞ Feed - SafeSpace') }}{% endblock %}
{% block content %}

    <div class="card feed-card">
        {#
          Formulario para crear una nueva publicaci√≥n directamente en el feed.  Se
          env√≠a al mismo endpoint que la p√°gina "Nueva publicaci√≥n" pero
          desaparece del men√∫.  Incluye un campo de texto y la opci√≥n de
          subir una imagen.  La vista previa de imagen se mostrar√° debajo
          cuando el usuario seleccione un archivo.  Las traducciones se
          reutilizan desde los archivos .po.
        #}
        <form method="POST" action="{{ url_for('home.nueva_publicacion') }}" enctype="multipart/form-data" class="nueva-publicacion-form feed-nueva-publicacion">
          <label for="content-feed" class="nueva-publicacion-label">{{ _('¬øQu√© quer√©s compartir?') }}</label>
          <textarea id="content-feed" name="content" rows="3" class="nueva-publicacion-textarea" placeholder="{{ _('Escrib√≠ algo...') }}" required></textarea>
          <label for="image-feed" class="file-label">üìé {{ _('Subir foto') }}</label>
          <input type="file" id="image-feed" name="image" accept="image/*" class="hidden-input" />
          <img id="img-preview-feed" class="preview-img" style="display:none;" />
          <button type="submit" class="btn btn-nueva-publicacion">{{ _('Publicar') }}</button>
        </form>

        <!-- Historias/estados en la parte superior del feed -->
        <div class="stories-row">
          <!-- Bot√≥n para crear un nuevo estado -->
          <div class="story-item create-story">
            <div class="story-avatar">+</div>
            <div class="story-label">{{ _('Crear estado') }}</div>
          </div>
          <!-- Mostrar algunos usuarios como ejemplo de historias existentes -->
          {% for post in publicaciones[:6] %}
            <div class="story-item">
              <div class="story-avatar">
                {% if post.author.profile_picture and 'http' in post.author.profile_picture %}
                  <img src="{{ post.author.profile_picture }}" alt="{{ _('Foto de perfil') }}" />
                {% else %}
                  <img src="{{ url_for('static', filename='profile_pics/' + (post.author.profile_picture or 'default.png')) }}" alt="{{ _('Foto de perfil') }}" />
                {% endif %}
              </div>
              <div class="story-label">{{ post.author.username }}</div>
            </div>
          {% endfor %}
        </div>

        <div class="feed-list">
        {% for post in publicaciones %}
          <div class="post-card">
            <div class="post-header">
              <img class="profile-pic"
                src="{% if post.author.profile_picture and 'http' in post.author.profile_picture %}
                       {{ post.author.profile_picture }}
                     {% else %}
                       {{ url_for('static', filename='profile_pics/' + (post.author.profile_picture or 'default.png')) }}
                     {% endif %}"
                alt="{{ _('Foto de perfil') }}"
              />
              <div>
                <div class="post-user">{{ post.author.username }}</div>
                <div class="post-date">{{ post.timestamp.strftime('%d/%m/%Y %H:%M') }}</div>
              </div>
            </div>
            <div class="post-content">
              {{ post.content }}
            </div>
            {% if post.image_url %}
              <img class="post-image" src="{{ post.image_url }}" alt="{{ _('Imagen de publicaci√≥n') }}">
            {% endif %}
          </div>
        {% else %}
          <div class="feed-empty">{{ _('No hay publicaciones todav√≠a.') }}</div>
        {% endfor %}
        </div>
    </div>
  
{% endblock %}
